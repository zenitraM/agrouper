
<header id="title">
	<h1>Oferta: <%= @order.offer.title %></h1>
</header>
<section>
	<div class="row show-grid">
		<div class="span4 pagination-centered">
			<div class="well">
				<h2>Apúntate</h2><br>
				<img src="http://chart.apis.google.com/chart?cht=qr&chs=300x300&chl=<%= url_for :action => :join, :id => @order.id, :only_path => false %>"><br>
				<div class="friendly-url">
					<div class="well">
						<%= url_for :action => :join, :id => @order.id, :only_path => false %>
					</div>
				</div>
			</div>
		</div>
		<div class="span8">
			<div class="row">
				<div class="span5">
					<div class="progress progress-striped progress-success active">
				    	<div class="bar" id="discount-bar" style="width: <%= @order.calculate_order_discount*100 / @order.offer.get_discounts.last[:lower_limit] *100 %>%;"></div>
				    </div>
				</div>
				<div class="span3 pagination-right">
					<div class="btn-group" style="float:right;">
						<a class="btn btn-success btn-large" href="#">Terminar pedido</a>
						<a class="btn btn-success btn-large" id="final-price"> <%= @order.get_total %> €</a>
					</div>
					<div class="clear"></div>
				</div>
			</div>
			<div class="row" style="margin-top: 20px">
				<div class="span8">
					<div class="well" id="updated_list">
						<%= render :template => "order/updated_list" %>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>

<script>

function updateList(){

	$.ajax({
  		url: "<%= url_for :controller => :order, :action => :updated_list, :id => @order.id %>",
		}).done(function(a) { 
  			$("#updated_list").html(a);
  			setTimeout(updateList,2000);
		});

}

function updatePrice(){

	$.ajax({
  		url: "<%= url_for :controller => :order, :action => :updated_price, :id => @order.id %>",
		}).done(function(a) {
			var price = a.split("/")[0] + " €";
			var percentage = a.split("/")[1] + "%";
			$("#final-price").html(price);
			$("#discount-bar").animate({
				width: percentage
			})
  			setTimeout(updatePrice,2000);
		});

}

setTimeout(updateList,2000);
setTimeout(updatePrice,2000);

</script>